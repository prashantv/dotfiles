#!/usr/bin/env bash

# Bash "strict" mode
set -euo pipefail
IFS=$'\n\t'

# Convert to base64, for OSC52
str=$(base64)

# If fd 1 is a terminal, print directly
if [ -t 1 ]
then
  printf '\033]52;c;%s\a' "${str}"
  exit 0
fi

# Check for tmux, which allows us to run the command in a new window.
if [ -n "${TMUX+x}" ]
then
  tmpfile=$(mktemp)
  printf '\033]52;c;%s\a' "${str}" > $tmpfile
  tmux new-window "cat $tmpfile"
  exit 0
fi

# Otherwise, fail, and report that command requires the terminal
echo "Copying requires terminal access" >&2
exit 1



